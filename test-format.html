<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Formato Markdown</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f9fafb;
        }
        
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        h4 {
            color: #1f2937;
            margin: 16px 0 4px 0;
            font-size: 1.1em;
        }
        
        h4 strong {
            font-weight: bold;
        }
        
        ul {
            margin: 8px 0 12px 0;
            padding-left: 20px;
            list-style-type: disc;
            list-style-position: outside;
        }
        
        li {
            margin: 6px 0;
            color: #374151;
            line-height: 1.5;
            font-weight: normal !important;
        }
        
        li strong {
            font-weight: normal !important;
        }
        
        ul li::marker {
            color: #6b7280;
            font-weight: normal;
        }
        
        ul li * {
            font-weight: normal !important;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Test de Formato Markdown</h1>
        
        <div id="test-content">
            <!-- El contenido se insertará aquí -->
        </div>
    </div>

    <script>
        // Función de prueba (copia de la función real)
        function formatTextContent(text) {
            if (!text) return '';
            
            let html = text;
            
            // Procesar listas PRIMERO (antes que cualquier otra cosa)
            const lines = html.split('\n');
            let inList = false;
            let processedLines = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const trimmedLine = line.trim();
                
                // Detectar inicio de lista (guión o asterisco seguido de espacio)
                if (trimmedLine.match(/^[*-]\s+/)) {
                    if (!inList) {
                        processedLines.push('<ul>');
                        inList = true;
                    }
                    const listItem = trimmedLine.replace(/^[*-]\s+/, '');
                    processedLines.push(`<li>${listItem}</li>`);
                } else {
                    // Si estábamos en una lista y ahora no, cerrar la lista
                    if (inList) {
                        processedLines.push('</ul>');
                        inList = false;
                    }
                    processedLines.push(line);
                }
            }
            
            // Cerrar lista si quedó abierta
            if (inList) {
                processedLines.push('</ul>');
            }
            
            html = processedLines.join('\n');
            
            // Convertir títulos de sección (líneas que terminan con :) - SOLO si NO están dentro de listas
            html = html.replace(/^([^:]+):$/gm, '<h4>$1:</h4>');
            
            // Convertir citas (texto entre comillas dobles)
            html = html.replace(/"([^"]+)"/g, '<blockquote>$1</blockquote>');
            
            // Convertir enlaces [texto](url)
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
            
            // Convertir saltos de línea dobles en párrafos
            html = html.replace(/\n\n+/g, '</p><p>');
            html = html.replace(/^(.+)$/gm, '<p>$1</p>');
            
            // Limpiar párrafos vacíos y párrafos que solo contienen HTML
            html = html.replace(/<p><\/p>/g, '');
            html = html.replace(/<p>(<[^>]+>.*<\/[^>]+>)<\/p>/g, '$1');
            
            // Convertir texto en negrita SOLO en títulos de sección
            html = html.replace(/<h4>([^<]+):<\/h4>/g, '<h4><strong>$1:</strong></h4>');
            
            // LIMPIEZA FINAL: Asegurar que el contenido de las listas NO esté en negrita
            html = html.replace(/<li><strong>/g, '<li>');
            html = html.replace(/<\/strong><\/li>/g, '</li>');
            html = html.replace(/<li>(.*?)<strong>(.*?)<\/strong>(.*?)<\/li>/g, '<li>$1$2$3</li>');
            
            return html;
        }

        // Texto de prueba
        const testText = `Curiosidades:
* En el censo de 1895, Francisco indica que tiene 36 años.
* En la partida de nacimiento de Luisa Clemenzo, en 1897, Francisco indica que tiene 36 años y que está soltero.
* En la partida de matrimonio de Leon Francisco Clemenzo, en 1913, se mencina que Francisco es carpintero y está domiciliado en Santa Fe.

Variaciones del apellido:
* Clemencean en el acta de defunción.`;

        // Aplicar el formato
        document.getElementById('test-content').innerHTML = formatTextContent(testText);
    </script>
</body>
</html>
